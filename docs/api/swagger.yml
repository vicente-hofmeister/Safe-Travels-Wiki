openapi: "3.0.3"
info:
  title: Safe Travels' Endpoints
  version: "1.0.0"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

servers:
  - url: https://0vek03sk8i.execute-api.us-east-1.amazonaws.com/

paths:
  /auth/login:
    post:
      summary: Authenticate user to access the API
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, password]
              properties:
                username:
                  type: string
                  example: john-doe
                password:
                  type: string
                  format: password
                  example: MyPassword@123
      responses:
        "200":
          description: Login was successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  expires_in:
                    type: integer
                    example: 3600
        "401":
          description: Invalid credentials
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /auth/refresh:
    post:
      summary: Use refresh token to revalidate authentication
      security: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [refreshToken]
              properties:
                refreshToken:
                  type: string
                  example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      responses:
        "200":
          description: Session refreshed
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  expires_in:
                    type: integer
                    example: 3600
        "401":
          description: unauthorized
        "403":
          description: Forbidden. User logged out
        "410":
          description: Expired refresh token
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /auth/logout:
    post:
      summary: Revokes the user authentication
      security: [bearerAuth: []]
      responses:
        "204":
          description: Logout was successful
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /auth/register:
    post:
      summary: Register a new user
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, username, email, password]
              properties:
                name:
                  type: string
                  example: "John Doe"
                username:
                  type: string
                  example: john-doe
                email:
                  type: string
                  format: email
                  example: john.doe@example.com
                password:
                  type: string
                  format: password
                  example: MyPassword@123
      responses:
        "201":
          description: User registered
        "400":
          description: Invalid credentials
        "409":
          description: There is another user with these credentials
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /auth/forgot-password:
    post:
      summary: User requests code to change password
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, email]
              properties:
                username:
                  type: string
                  example: john-doe
                email:
                  type: string
                  format: email
                  example: john.doe@example.com
      responses:
        "200":
          description: If there is an account with this username and e-mail, a code will be sent
        "400":
          description: Invalid credentials
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /auth/reset-password:
    post:
      summary: User sends it's reset code and new password to confirm password change
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, email, password, resetCode]
              properties:
                username:
                  type: string
                  example: john-doe
                email: # usar aqui???
                  type: string
                  format: email
                  example: john.doe@example.com
                password:
                  type: string
                  format: password
                  example: MyPassword@123
                resetCode:
                  type: string
                  example: "123456"
      responses:
        "200":
          description: Password reseted successfully
        "400":
          description: Invalid credentials
        "401":
          description: Invalid code
        "410":
          description: Expired code
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /auth/change-password:
    post:
      summary: Authenticated user changes it's password
      security: [bearerAuth: []]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [newPassword]
              properties:
                newPassword:
                  type: string
                  format: password
                  example: MyPassword@123
      responses:
        "200":
          description: Password changed successfully
        "400":
          description: Invalid password
        "401":
          description: User unauthorized
        "409":
          description: New password is the same as the old one
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /auth/verify-email:
    post:
      summary: User verifies it's e-mail confirming given code
      security: [bearerAuth: []]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, code]
              properties:
                email:
                  type: string
                  format: email
                  example: john.doe@example.com
                code:
                  type: string
                  example: "123456"
      responses:
        "200":
          description: E-mail verified
        "400":
          description: Invalid credentials
        "410":
          description: Expired code
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /auth/verify-phone:
    post:
      summary: User verifies it's phone confirming given code
      security: [bearerAuth: []]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [phone, code]
              properties:
                phone:
                  type: string
                  pattern: '^\+[1-9]\d{1,14}$'
                  example: "+5551987654321"
                code:
                  type: string
                  example: "123456"
      responses:
        "200":
          description: Phone verified
        "400":
          description: Invalid credentials
        "410":
          description: Expired code
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /auth/register-device:
    post:
      summary: Register a new location device to a user
      security: [bearerAuth: []]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - type
                - value
              properties:
                type:
                  type: string
                  enum: [email, phone]
                  example: email
                value:
                  type: string
                  description: E-mail or phone in internacional pattern (E.164)
                  example: "+55 51 99999-9999"
      responses:
        "201":
          description: Device successfully registered
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                    example: "c21f969b-5f03-4333-9a9d-6a5566e8a5e7"
                  type:
                    type: string
                  value:
                    type: string
        "400":
          description: Invalid data
        "409":
          description: Device already registered
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /user/get-profile/{user_id}:
    get:
      summary: Get a user's profile information
      security: [bearerAuth: []]
      parameters:
        - name: user_id
          in: path
          required: true
          description: UUID of the user
          schema:
            type: string
            format: uuid
            example: "c21f969b-5f03-4333-9a9d-6a5566e8a5e7"
      responses:
        "200":
          description: Successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  user_id:
                    type: string
                    format: uuid
                    example: "c21f969b-5f03-4333-9a9d-6a5566e8a5e7"
                  username:
                    type: string
                    example: john-doe
                  name:
                    type: string
                    example: "John Doe"
                  profile_image:
                    type: string
                    format: uri
                    example: "https://example.com/uploads/profile-picture.png"
        "400":
          description: Invalid id
        "401":
          description: unauthorized
        "403":
          description: Forbidden. User can't fetch this information
        "404":
          description: User not found.
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /user/set-privacy:
    post:
      summary: Defines privacy settings
      security: [bearerAuth: []]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        "200":
          description: privacy settings updated successfully
        "400":
          description: Invalid privacy settings
        "401":
          description: unauthorized
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /user/ask-to-follow/{user_id}:
    get:
      summary: Ask to follow another user
      security: [bearerAuth: []]
      parameters:
        - name: user_id
          in: path
          required: true
          description: UUID of the user
          schema:
            type: string
            format: uuid
            example: "c21f969b-5f03-4333-9a9d-6a5566e8a5e7"
      responses:
        "200":
          description: Successful operation
        "400":
          description: Invalid id
        "401":
          description: unauthorized
        "404":
          description: User not found.
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /user/accept-follower/{user_id}:
    get:
      summary: Accept another user's request to follow
      security: [bearerAuth: []]
      parameters:
        - name: user_id
          in: path
          required: true
          description: UUID of the user
          schema:
            type: string
            format: uuid
            example: "c21f969b-5f03-4333-9a9d-6a5566e8a5e7"
      responses:
        "200":
          description: Successful operation
        "400":
          description: Invalid id
        "401":
          description: unauthorized
        "404":
          description: User or request not found.
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /user/change-follower-tier:
    post:
      summary: Change the follower category
      security: [bearerAuth: []]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        "200":
          description: Successful operation
        "400":
          description: invalid payload
        "401":
          description: unauthorized
        "404":
          description: Follower not found.
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /user/remove-follower/{user_id}:
    delete:
      summary: Remove another user from the list of followers of the user who made the request
      security: [bearerAuth: []]
      parameters:
        - name: user_id
          in: path
          required: true
          description: UUID of the user to be removed
          schema:
            type: string
            format: uuid
            example: "c21f969b-5f03-4333-9a9d-6a5566e8a5e7"
      responses:
        "200":
          description: Follower removed successfully
        "400":
          description: Invalid id
        "401":
          description: unauthorized
        "404":
          description: Follower not found.
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /user/stop_following/{user_id}:
    delete:
      summary: Stop following another user
      security: [bearerAuth: []]
      parameters:
        - name: user_id
          in: path
          required: true
          description: UUID of the user
          schema:
            type: string
            format: uuid
            example: "c21f969b-5f03-4333-9a9d-6a5566e8a5e7"
      responses:
        "200":
          description: Successful operation
        "400":
          description: Invalid id
        "401":
          description: unauthorized
        "404":
          description: User not found.
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /user/get-location/{user_id}:
    get:
      summary: Get a user's current location. Granularity depends on the following tier.
      security: [bearerAuth: []]
      parameters:
        - name: user_id
          in: path
          required: true
          description: UUID of the user
          schema:
            type: string
            format: uuid
            example: "c21f969b-5f03-4333-9a9d-6a5566e8a5e7"
      responses:
        "200":
          description: Successful operation
        "400":
          description: Invalid id
        "401":
          description: unauthorized
        "403":
          description: Doesn't have permission to get the user location
        "404":
          description: User not found.
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /user/send-location:
    post:
      summary: Send location information to the API. May be single data or batch. Asynchronous processing for faster response.
      security: [bearerAuth: []]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        "200":
          description: Successful operation
        "400":
          description: invalid payload
        "401":
          description: unauthorized
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /group/create:
    post:
      summary: Creates a new group_id
      security: [bearerAuth: []]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        "200":
          description: Group created
        "400":
          description: Invalid payload
        "401":
          description: unauthorized
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /group/invite:
    post:
      summary: Invite an user to be part of a group
      security: [bearerAuth: []]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        "200":
          description: Invite sent
        "400":
          description: invalid payload
        "401":
          description: unauthorized
        "403":
          description: User is not allowed to invite to this group
        "404":
          description: User or group not found.
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /group/respond-invite:
    post:
      summary: Respond an invite to join a group
      security: [bearerAuth: []]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        "200":
          description: Response sent (accept or deny)
        "400":
          description: invalid payload
        "401":
          description: unauthorized
        "404":
          description: Group or invite not found.
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /group/remove-member/{group_id}/{user_id}:
    delete:
      summary: Remove another user from the list of members of a group who made the request
      security: [bearerAuth: []]
      parameters:
        - name: group_id
          in: path
          required: true
          description: UUID of the group
          schema:
            type: string
            format: uuid
            example: "c21f969b-5f03-4333-9a9d-6a5566e8a5e7"
        - name: user_id
          in: path
          required: true
          description: UUID of the user to be removed
          schema:
            type: string
            format: uuid
            example: "c21f969b-5f03-4333-9a9d-6a5566e8a5e7"
      responses:
        "200":
          description: Member removed successfully
        "400":
          description: Invalid id
        "401":
          description: unauthorized
        "403":
          description: User doesn't have permission to remove members from this group
        "404":
          description: Member or group not found.
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /group/leave/{group_id}:
    delete:
      summary: Leave a group
      security: [bearerAuth: []]
      parameters:
        - name: group_id
          in: path
          required: true
          description: UUID of the group
          schema:
            type: string
            format: uuid
            example: "c21f969b-5f03-4333-9a9d-6a5566e8a5e7"
      responses:
        "200":
          description: User is no longer member of the group
        "400":
          description: Invalid id
        "401":
          description: unauthorized
        "403":
          description: User isn't part of the group
        "404":
          description: Group not found.
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /group/set-group-privacy:
    post:
      summary: Defines the group privacy settings
      security: [bearerAuth: []]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        "200":
          description: group privacy settings updated successfully
        "400":
          description: Invalid privacy settings
        "401":
          description: unauthorized
        "403":
          description: User doesn't have permission to change the group privacy settings (isn't admin/owner)
        "404":
          description: Group not found
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /group/set-user-privacy:
    post:
      summary: Defines a user privacy setting regarding a specific group.
      security: [bearerAuth: []]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        "200":
          description: member privacy settings updated successfully
        "400":
          description: Invalid privacy settings
        "401":
          description: unauthorized
        "403":
          description: User isn't a group member.
        "404":
          description: Group not found.
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /group/ask-to-follow/{group_id}:
    get:
      summary: Ask to follow a group
      security: [bearerAuth:[]]
      parameters:
        - name: group_id
          in: path
          required: true
          description: UUID of the group
          schema:
            type: string
            format: uuid
            example: "c21f969b-5f03-4333-9a9d-6a5566e8a5e7"
      responses:
        "200":
          description: Successful operation
        "400":
          description: Invalid id
        "401":
          description: Unauthorized
        "404":
          description: Group not found.
        "429":
          description: Too many requests
        "500":
          description: Internal server error
  
  /group/accept-follower/{user_id}:
    get:
      summary: Accept another user's request to follow
      security: [bearerAuth: []]
      parameters:
        - name: user_id
          in: path
          required: true
          description: UUID of the user
          schema:
            type: string
            format: uuid
            example: "c21f969b-5f03-4333-9a9d-6a5566e8a5e7"
      responses:
        "200":
          description: Successful operation
        "400":
          description: Invalid id
        "401":
          description: unauthorized
        "404":
          description: User or request not found.
        "429":
          description: Too many requests
        "500":
          description: Internal server error
  
  /group/remove-follower/{group_id}/{user_id}:
    delete:
      summary: Remove an user from the list of followers of the group
      security: [bearerAuth: []]
      parameters:
        - name: group_id
          in: path
          required: true
          description: UUID of the group
          schema:
            type: string
            format: uuid
            example: "c21f969b-5f03-4333-9a9d-6a5566e8a5e7"
        - name: user_id
          in: path
          required: true
          description: UUID of the user to be removed
          schema:
            type: string
            format: uuid
            example: "c21f969b-5f03-4333-9a9d-6a5566e8a5e7"
      responses:
        "200":
          description: Follower removed successfully
        "400":
          description: Invalid id
        "401":
          description: unauthorized
        "403":
          description: User doesn't have permission to remove followers from this group
        "404":
          description: Follower not found.
        "429":
          description: Too many requests
        "500":
          description: Internal server error
  
  /group/stop_following/{group_id}:
    delete:
      summary: Stop following a group
      security: [bearerAuth: []]
      parameters:
        - name: user_id
          in: path
          required: true
          description: UUID of the user
          schema:
            type: string
            format: uuid
            example: "c21f969b-5f03-4333-9a9d-6a5566e8a5e7"
      responses:
        "200":
          description: Successful operation
        "400":
          description: Invalid id
        "401":
          description: unauthorized
        "404":
          description: Group not found.
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /group/get-location/{group_id}:
    get:
      summary: Get a group's current location. Granularity depends on the following tier.
      security: [bearerAuth: []]
      parameters:
        - name: group_id
          in: path
          required: true
          description: UUID of the group
          schema:
            type: string
            format: uuid
            example: "c21f969b-5f03-4333-9a9d-6a5566e8a5e7"
      responses:
        "200":
          description: Successful operation
        "400":
          description: Invalid id
        "401":
          description: unauthorized
        "403":
          description: Doesn't have permission to get the group location
        "404":
          description: Group not found.
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /trip/get-trip-sumary/{trip_id}:
    get:
      summary: Get a trip's basic informaiton
      security: [bearerAuth: []]
      parameters:
        - name: trip_id
          in: path
          required: true
          description: UUID of the trip
          schema:
            type: string
            format: uuid
            example: "c21f969b-5f03-4333-9a9d-6a5566e8a5e7"
      responses:
        "200":
          description: Successful operation
        "400":
          description: Invalid id
        "401":
          description: unauthorized
        "403":
          description: Doesn't have permission to view this trip
        "404":
          description: Trip not found.
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /trip/get-trip-details/{trip_id}:
    get:
      summary: Get a trip's complete informaiton
      security: [bearerAuth: []]
      parameters:
        - name: trip_id
          in: path
          required: true
          description: UUID of the trip
          schema:
            type: string
            format: uuid
            example: "c21f969b-5f03-4333-9a9d-6a5566e8a5e7"
      responses:
        "200":
          description: Successful operation
        "400":
          description: Invalid id
        "401":
          description: unauthorized
        "403":
          description: Doesn't have permission to view this trip
        "404":
          description: Trip not found.
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /trip/list-trips/user/{user_id}:
    get:
      summary: List a user's trips
      security: [bearerAuth: []]
      parameters:
        - name: user_id
          in: path
          required: true
          description: UUID of the user
          schema:
            type: string
            format: uuid
            example: "c21f969b-5f03-4333-9a9d-6a5566e8a5e7"
      responses:
        "200":
          description: Successful operation
        "400":
          description: Invalid id
        "401":
          description: unauthorized
        "403":
          description: Doesn't have permission to list this user's trip
        "404":
          description: User not found.
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /trip/list-trips/group/{group_id}:
    get:
      summary: List a groups's trips
      security: [bearerAuth: []]
      parameters:
        - name: group_id
          in: path
          required: true
          description: UUID of the group
          schema:
            type: string
            format: uuid
            example: "c21f969b-5f03-4333-9a9d-6a5566e8a5e7"
      responses:
        "200":
          description: Successful operation
        "400":
          description: Invalid id
        "401":
          description: unauthorized
        "403":
          description: Doesn't have permission to list this group's trip
        "404":
          description: User not found.
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /trip/get-user-current-trip/{user_id}:
    get:
      summary: Fetch the current trip from a user
      security: [bearerAuth: []]
      parameters:
        - name: user_id
          in: path
          required: true
          description: UUID of the user
          schema:
            type: string
            format: uuid
            example: "c21f969b-5f03-4333-9a9d-6a5566e8a5e7"
      responses:
        "200":
          description: Successful operation
        "400":
          description: Invalid id
        "401":
          description: unauthorized
        "403":
          description: Doesn't have permission to get this user's trip
        "404":
          description: User not found.
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /trip/get-group-current-trip/{group_id}:
    get:
      summary: Fetch the current trip from a group
      security: [bearerAuth: []]
      parameters:
        - name: group_id
          in: path
          required: true
          description: UUID of the group
          schema:
            type: string
            format: uuid
            example: "c21f969b-5f03-4333-9a9d-6a5566e8a5e7"
      responses:
        "200":
          description: Successful operation
        "400":
          description: Invalid id
        "401":
          description: unauthorized
        "403":
          description: Doesn't have permission to get this group's trip
        "404":
          description: Group not found.
        "429":
          description: Too many requests
        "500":
          description: Internal server error

  /location/send-location:
    post:
      summary: Fallback endpoint to send location data if Kinesis fails.
      security: [bearerAuth: []]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        "200":
          description: Location data received successfully
        "400":
          description: Invalid data
        "401":
          description: unauthorized
        "404":
          description: user not found.
        "429":
          description: Too many requests
        "500":
          description: Internal server error
